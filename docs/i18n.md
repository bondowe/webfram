---
layout: default
title: Internationalization
nav_order: 13
description: "Multi-language support with i18n"
---

# Internationalization (i18n)

WebFram provides built-in i18n support using `golang.org/x/text`.

## Overview

WebFram's i18n system includes:

- Automatic language detection from cookies and Accept-Language headers
- Template integration with `T` function
- Programmatic translation in handlers
- Multi-language message extraction tool

## Generating Message Files

Use the `webfram-i18n` tool to extract translatable strings:

**Installation:**

```bash
go install github.com/bondowe/webfram/cmd/webfram-i18n@latest
```

**Extract from templates and code:**

```bash
webfram-i18n -languages "en,fr,es" -templates ./assets/templates
```

**Extract only from Go code:**

```bash
webfram-i18n -languages "en,fr" -mode code
```

**Extract only from templates:**

```bash
webfram-i18n -languages "en,de" -mode templates -templates ./assets/templates
```

**Custom output directory:**

```bash
webfram-i18n -languages "en,fr" -templates ./assets/templates -locales ./assets/locales
```

**Command-Line Flags:**

| Flag | Default | Description |
|------|---------|-------------|
| `-languages` | _(required)_ | Comma-separated language codes |
| `-templates` | _(required for templates mode)_ | Template directory |
| `-mode` | `both` | `templates`, `code`, or `both` |
| `-code` | `.` | Go source directory |
| `-locales` | `./locales` | Output directory |

## Message Files

Create JSON message files in your locales directory:

**locales/messages.en.json:**

```json
{
  "language": "en",
  "messages": [
    {
      "id": "Welcome to %s! Clap %d times.",
      "message": "Welcome to %s! Clap %d times.",
      "translation": "Welcome to %s! Clap %d times.",
      "placeholders": {
        "arg_1": {
          "id": "arg_1",
          "string": "%s",
          "type": "string",
          "argNum": 1
        },
        "arg_2": {
          "id": "arg_2",
          "string": "%d",
          "type": "int",
          "argNum": 2
        }
      }
    }
  ]
}
```

**locales/messages.fr.json:**

```json
{
  "language": "fr",
  "messages": [
    {
      "id": "Welcome to %s! Clap %d times.",
      "message": "Welcome to %s! Clap %d times.",
      "translation": "Bienvenue à %s! Applaudissez %d fois.",
      "placeholders": {
        "arg_1": {
          "id": "arg_1",
          "string": "%s",
          "type": "string",
          "argNum": 1
        },
        "arg_2": {
          "id": "arg_2",
          "string": "%d",
          "type": "int",
          "argNum": 2
        }
      }
    }
  ]
}
```

## Configuration

```go
//go:embed all:assets
var assetsFS embed.FS

app.Configure(&app.Config{
    Assets: &app.Assets{
        FS: assetsFS,
        I18nMessages: &app.I18nMessages{
            Dir: "assets/locales",
            SupportedLanguages: []string{"en", "fr", "es", "de"}, // Optional
        },
    },
})
```

### Language Detection

WebFram automatically detects language using:

1. **Language Cookie** (`lang` cookie) - Highest priority
2. **Accept-Language Header** - Parsed with quality values
3. **Default Language** - First in `SupportedLanguages` or English

**Example Accept-Language matching:**

```text
Accept-Language: fr-FR,fr;q=0.9,en;q=0.8,de;q=0.7
Supported: ["en", "fr", "es"]
Result: French (fr) - highest quality supported language
```

### Supported Languages Configuration

**Automatic Detection (Recommended):**

WebFram auto-detects languages from message files:

```text
assets/locales/
  ├── messages.en.json
  ├── messages.fr.json
  ├── messages.es.json
  └── messages.de.json
```

```go
app.Configure(&app.Config{
    Assets: &app.Assets{
        FS: assetsFS,
        I18nMessages: &app.I18nMessages{
            Dir: "assets/locales",
            // SupportedLanguages auto-detected
        },
    },
})
```

**Explicit Configuration:**

```go
app.Configure(&app.Config{
    Assets: &app.Assets{
        FS: assetsFS,
        I18nMessages: &app.I18nMessages{
            Dir: "assets/locales",
            SupportedLanguages: []string{"en", "fr"}, // Only EN and FR
        },
    },
})
```

## Using i18n in Templates

The i18n function is automatically available as `T`:

```html
{{define "content"}}
<h1>{{T "Welcome to %s! Clap %d times." "WebFram" 5}}</h1>

<p>{{T "Hello, %s!" .User.Name}}</p>

<ul>
    {{range .Items}}
    <li>{{T "Item: %s" .Name}}</li>
    {{end}}
</ul>
{{end}}
```

## Using i18n in Handlers

```go
import "golang.org/x/text/language"

mux.HandleFunc("GET /greeting", func(w app.ResponseWriter, r *app.Request) {
    // Get Spanish printer
    printer := app.GetI18nPrinter(language.Spanish)
    msg := printer.Sprintf("Welcome to %s! Clap %d times.", "WebFram", 5)
    
    w.JSON(r.Context(), map[string]string{"message": msg})
})
```

## Setting Language Preferences

Set user language via cookie:

```go
mux.HandleFunc("POST /set-language", func(w app.ResponseWriter, r *app.Request) {
    lang := r.FormValue("language")
    
    // Set cookie for 30 days
    app.SetLanguageCookie(w, lang, 30*24*3600)
    
    w.JSON(r.Context(), map[string]string{"message": "Language saved"})
})
```

**Cookie parameters:**

- `language`: Language code (e.g., "fr", "es")
- `maxAge`: Lifetime in seconds
  - Positive: Expires after N seconds
  - `-1`: Session cookie
  - `0`: Delete cookie

## Complete Example

```go
//go:embed all:assets
var assetsFS embed.FS

func main() {
    app.Configure(&app.Config{
        Assets: &app.Assets{
            FS: assetsFS,
            Templates: &app.Templates{
                Dir: "assets/templates",
            },
            I18nMessages: &app.I18nMessages{
                Dir: "assets/locales",
            },
        },
    })

    mux := app.NewServeMux()

    // Home page with i18n
    mux.HandleFunc("GET /", func(w app.ResponseWriter, r *app.Request) {
        data := map[string]interface{}{
            "AppName": "WebFram",
            "Count":   5,
        }
        err := w.HTML(r.Context(), "home/index", data)
        if err != nil {
            w.Error(http.StatusInternalServerError, err.Error())
        }
    })

    // Change language
    mux.HandleFunc("POST /language", func(w app.ResponseWriter, r *app.Request) {
        lang := r.FormValue("lang")
        app.SetLanguageCookie(w, lang, 30*24*3600)
        w.Redirect(r.Request, "/", http.StatusSeeOther)
    })

    // API with i18n
    mux.HandleFunc("GET /api/greeting", func(w app.ResponseWriter, r *app.Request) {
        printer := app.GetI18nPrinter(language.French)
        msg := printer.Sprintf("Welcome to %s!", "WebFram")
        w.JSON(r.Context(), map[string]string{"greeting": msg})
    })

    app.ListenAndServe(":8080", mux, nil)
}
```

**Template** (`templates/home/index.go.html`):

```html
{{define "content"}}
<h1>{{T "Welcome to %s! Clap %d times." .AppName .Count}}</h1>

<form action="/language" method="POST">
    <select name="lang">
        <option value="en">English</option>
        <option value="fr">Français</option>
        <option value="es">Español</option>
    </select>
    <button type="submit">{{T "Change Language"}}</button>
</form>
{{end}}
```

## Best Practices

1. **Use go generate** - Automate message extraction
2. **Message IDs** - Use English text as ID
3. **Placeholders** - Use `%s`, `%d`, etc.
4. **Context** - Provide translator context
5. **Pluralization** - Use separate messages for plural forms
6. **Test translations** - Verify all languages
7. **Fallback** - Always provide English translation

## go generate Integration

Add to your Go files:

```go
//go:generate go run github.com/bondowe/webfram/cmd/webfram-i18n@latest -languages "en,fr,es" -templates assets/templates -locales assets/locales
```

Run:

```bash
go generate ./...
```

## See Also

- [Templates](templates.html)
- [Configuration](configuration.html)
- [Request & Response](request-response.html)
